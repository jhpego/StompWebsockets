"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const model_1 = require("./model");
const protocol_1 = require("./protocol");
const session_1 = require("./session");
const utils_1 = require("./utils");
const stream_1 = require("./stream");
const frame_1 = require("./frame");
class StompBrokerLayerImpl {
    constructor(listener, config) {
        this.listener = listener;
        this.config = config;
        this.nextSessionId = utils_1.counter(); //TODO: let the user choice the Session ID generation strategy.
        this.sessions = new Map();
        this.subscriptions = new BrokerSubscriptionsRegistry();
    }
    accept(socket) {
        const sessionId = this.nextSessionId(); //TODO: validate session ID before using it (in case of custom generation strategy)
        const streamLayer = stream_1.openStream(socket);
        const frameLayer = new frame_1.StompFrameLayer(streamLayer);
        frameLayer.headerFilter = this.config && this.config.headersFilter || frameLayer.headerFilter;
        const clientListener = new BrokerClientCommandListener(this, sessionId);
        const session = new session_1.StompServerSessionLayer(frameLayer, clientListener);
        clientListener.session = session;
        session.sendErrorHandler = (err) => this.listener.sessionError(sessionId, err);
        session.data.id = sessionId;
        this.sessions.set(sessionId, session);
        return sessionId;
    }
    forDestination(destination, callback) {
        this.subscriptions.forDestination(destination, callback);
    }
    sendMessage(message, destination, sessionId) {
        if (sessionId) {
            if (!this.sessions.has(sessionId)) {
                throw new Error(`Session with ID ${sessionId} not found`);
            }
            this.subscriptions.forSessionDestination(sessionId, destination, (subscription) => {
                this.sendToSession(message, sessionId, subscription).catch(e => this.listener.sessionError(sessionId, e));
            });
        }
        else {
            this.forDestination(destination, (sessionId, subscription) => {
                this.sendToSession(message, sessionId, subscription).catch(e => this.listener.sessionError(sessionId, e));
            });
        }
    }
    async sendToSession(message, sessionId, subscription) {
        const session = this.sessions.get(sessionId);
        const headers = Object.assign({
            subscription: subscription.id,
            destination: subscription.destination
        }, message.headers);
        await session.message(headers, message.body);
    }
    sessionEnd(sessionId) {
        this.subscriptions.remove(sessionId);
        this.sessions.delete(sessionId);
    }
}
exports.StompBrokerLayerImpl = StompBrokerLayerImpl;
class BrokerClientCommandListener {
    constructor(broker, sessionId) {
        this.broker = broker;
        this.sessionId = sessionId;
        this.nextSubscriptionId = utils_1.counter(); //TODO: let the user choice the Subscription ID generation strategy.
        this.sessionError = (err) => this.broker.listener.sessionError(this.sessionId, err);
        this.transactions = new Set();
    }
    connect(headers) {
        this.doConnect(headers).catch(this.sessionError);
    }
    send(headers, body) {
        this.doSend(headers, body).catch(this.sessionError);
    }
    subscribe(headers) {
        this.doSubscribe(headers).catch(this.sessionError);
    }
    unsubscribe(headers) {
        this.doUnubscribe(headers).catch(this.sessionError);
    }
    begin(headers) {
        this.doBegin(headers).catch(this.sessionError);
    }
    commit(headers) {
        this.doBeforeDeletingTransaction(headers, (id) => this.broker.listener.committingTransaction(this.sessionId, id));
    }
    abort(headers) {
        this.doBeforeDeletingTransaction(headers, (id) => this.broker.listener.abortingTransaction(this.sessionId, id));
    }
    ack(headers) {
        this.doAcknowledge(true, headers).catch(this.sessionError);
    }
    nack(headers) {
        this.doAcknowledge(false, headers).catch(this.sessionError);
    }
    disconnect(headers) {
        this.doDisconnect(headers).catch(this.sessionError);
    }
    onProtocolError(error) {
        this.broker.listener.sessionError(this.sessionId, error);
    }
    onEnd() {
        this.broker.sessionEnd(this.sessionId);
        this.broker.listener.sessionEnd(this.sessionId);
        //TODO: cleanup subscriptions
    }
    async doConnect(headers) {
        try {
            await this.broker.listener.connecting(this.sessionId, headers);
            await this.session.connected({ version: this.session.protocolVersion, server: 'StompBroker/1.0.0' }); //TODO: configure broker name
        }
        catch (err) {
            utils_1.log.debug("StompBrokerLayer: error while connecting session %s: %O", this.session.data.id, err);
            await this.sendErrorFrame(err);
        }
    }
    /**
     * Sends an ERROR frame.
     * @param  headers Stomp Headers
     * @param  err     Stomp Error
     */
    async sendErrorFrame(err, headers) {
        headers = headers || {};
        headers.message = err.message;
        await this.session.error(headers, err.details);
    }
    async doSend(headers, body) {
        try {
            await this.broker.listener.incomingMessage(this.sessionId, headers, body);
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    async doDisconnect(headers) {
        try {
            await this.broker.listener.disconnecting(this.sessionId, headers);
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    /**
     * Sends a RECEIPT frame, if the request headers contain a receipt ID.
     * @param  headers Stomp Headers that may contain a receipt ID
     * @param  err     Stomp Error object created by user
     */
    async receiptCallback(headers, err) {
        const receipt = typeof headers.receipt === 'string' ? headers.receipt : undefined;
        if (err) {
            await this.sendErrorFrame(err, receipt ? { 'receipt-id': receipt } : undefined);
        }
        else if (receipt) {
            await this.session.receipt({ 'receipt-id': receipt });
        }
    }
    async doSubscribe(headers) {
        if (this.session.protocolVersion == protocol_1.StompProtocolHandlerV10.version && !headers.id) {
            // version 1.0 does not require subscription id header, we must generate it.
            headers.id = 'sub_' + this.nextSubscriptionId();
        }
        const subscription = Object.seal({
            id: headers.id,
            destination: headers.destination,
            ack: headers.ack || 'auto'
        });
        try {
            this.broker.subscriptions.add(this.sessionId, subscription);
            try {
                await this.broker.listener.subscribing(this.sessionId, subscription);
            }
            catch (err) {
                this.broker.subscriptions.remove(this.sessionId, subscription.id);
                throw err;
            }
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    async doUnubscribe(headers) {
        let subscription;
        if (headers.id) {
            subscription = this.broker.subscriptions.get(this.sessionId, headers.id);
        }
        else {
            // Fallback for version 1.0: get the first available subscription for the given destination.
            this.broker.subscriptions.forSessionDestination(this.sessionId, headers.destination, (sub) => {
                subscription = sub;
                return false;
            });
        }
        try {
            if (!subscription) {
                utils_1.log.debug("StompBrokerLayer: error while unsubscribing, cannot find subscription for session %s: %O", this.sessionId, headers);
                throw new model_1.StompError("Cannot unsubscribe: unknown subscription ID or destination.");
            }
            await this.broker.listener.unsubscribing(this.sessionId, subscription);
            this.broker.subscriptions.remove(this.sessionId, subscription.id);
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    async doAcknowledge(value, headers) {
        const ack = {
            value,
            messageId: headers.id || headers.messageId
        };
        if (headers.transaction) {
            ack.transaction = headers.transaction;
        }
        if (headers.subscription) {
            ack.subscription = headers.subscription;
        }
        try {
            await this.broker.listener.acknowledging(this.sessionId, ack);
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    async doBegin(headers) {
        try {
            const id = headers.transaction;
            if (this.transactions.has(id)) {
                throw new model_1.StompError(`Transaction with ID ${id} already started for session ${this.sessionId}.`);
            }
            this.transactions.add(id);
            try {
                await this.broker.listener.beginningTransaction(this.sessionId, id);
            }
            catch (err) {
                this.transactions.delete(id);
                throw err;
            }
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
    async doBeforeDeletingTransaction(headers, fn) {
        try {
            const id = headers.transaction;
            if (!this.transactions.has(id)) {
                throw new model_1.StompError(`Transaction with ID ${id} not found for session ${this.sessionId}.`);
            }
            try {
                await fn(id);
            }
            catch (err) {
                throw err;
            }
            finally {
                this.transactions.delete(id);
            }
            await this.receiptCallback(headers);
        }
        catch (err) {
            await this.receiptCallback(headers, err);
        }
    }
}
class BrokerSubscriptionsRegistry {
    constructor() {
        this.bySessionId = new Map();
        this.byDestination = new Map();
        // TODO: filter method
    }
    add(sessionId, subscription) {
        let sessionReg = this.bySessionId.get(sessionId);
        if (!sessionReg) {
            this.bySessionId.set(sessionId, sessionReg = new SessionSubscriptionsRegistry(sessionId));
        }
        sessionReg.add(subscription);
        let arr = this.byDestination.get(subscription.destination);
        if (!arr) {
            this.byDestination.set(subscription.destination, arr = []);
        }
        arr.push(sessionReg);
    }
    get(sessionId, subscriptionId) {
        const reg = this.bySessionId.get(sessionId);
        return reg && reg.get(subscriptionId);
    }
    remove(sessionId, subscriptionId) {
        const reg = this.bySessionId.get(sessionId);
        if (reg) {
            if (subscriptionId) { // remove just a single subscription for the given session
                this.removeFromDestinationMap(reg, subscriptionId);
                reg.remove(subscriptionId);
            }
            else {
                // remove all subscriptions for the given session
                for (let dest of reg.destinations) {
                    const arr = this.byDestination.get(dest);
                    let i = arr.findIndex(s => s === reg);
                    while (i >= 0) {
                        arr.splice(i, 1);
                        i = arr.findIndex(s => s === reg);
                    }
                }
                this.bySessionId.delete(sessionId);
            }
        }
        return !!reg;
    }
    removeFromDestinationMap(reg, subscriptionId) {
        const subscription = reg.get(subscriptionId);
        if (subscription) {
            const destination = subscription.destination;
            let i = 0; // counts how many subscription of this session to the given destination
            reg.forDestination(destination, () => (i++, true));
            if (i === 1) { // last subscription of this session for the given destination
                const arr = this.byDestination.get(destination);
                arr.splice(arr.findIndex(s => s === reg), 1);
            }
        }
    }
    forSessionDestination(sessionId, destination, callback) {
        const reg = this.bySessionId.get(sessionId);
        if (reg) {
            reg.forDestination(destination, sub => callback(sub) || true);
        }
    }
    forDestination(destination, callback) {
        const sessionRegs = this.byDestination.get(destination);
        if (sessionRegs) {
            sessionRegs.every(reg => reg.forDestination(destination, callback.bind(null, reg.sessionId)) || true);
        }
    }
}
exports.BrokerSubscriptionsRegistry = BrokerSubscriptionsRegistry;
class SessionSubscriptionsRegistry {
    constructor(sessionId) {
        this.sessionId = sessionId;
        this.byId = new Map();
        this.byDestination = new Map();
    }
    get destinations() {
        return this.byDestination.keys();
    }
    add(subscription) {
        if (this.byId.has(subscription.id)) {
            throw new model_1.StompError(`Subscription ID ${subscription.id} already found for session ${this.sessionId}.`);
        }
        this.byId.set(subscription.id, subscription);
        let arr = this.byDestination.get(subscription.destination);
        if (!arr) {
            this.byDestination.set(subscription.destination, arr = []);
        }
        arr.push(subscription);
    }
    remove(id) {
        const subscription = this.byId.get(id);
        if (subscription) {
            this.byId.delete(id);
            const arr = this.byDestination.get(subscription.destination);
            arr.splice(arr.findIndex(s => s.id === id), 1);
        }
        return !!subscription;
    }
    get(id) {
        const sub = this.byId.get(id);
        return sub && Object.seal(Object.assign({}, sub));
    }
    forDestination(destination, callback) {
        const arr = this.byDestination.get(destination);
        if (arr) {
            return arr.every(callback);
        }
        return true;
    }
}
exports.SessionSubscriptionsRegistry = SessionSubscriptionsRegistry;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJva2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2Jyb2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUE4RTtBQUM5RSx5Q0FBaUY7QUFDakYsdUNBQW9EO0FBQ3BELG1DQUFzRDtBQUN0RCxxQ0FBc0M7QUFDdEMsbUNBQTBDO0FBb0QxQztJQU9JLFlBQXFCLFFBQTZCLEVBQVcsTUFBb0I7UUFBNUQsYUFBUSxHQUFSLFFBQVEsQ0FBcUI7UUFBVyxXQUFNLEdBQU4sTUFBTSxDQUFjO1FBTGhFLGtCQUFhLEdBQUcsZUFBTyxFQUFFLENBQUMsQ0FBQywrREFBK0Q7UUFFbEcsYUFBUSxHQUFHLElBQUksR0FBRyxFQUFtQyxDQUFDO1FBQ3RELGtCQUFhLEdBQUcsSUFBSSwyQkFBMkIsRUFBRSxDQUFDO0lBRTBCLENBQUM7SUFFL0UsTUFBTSxDQUEwQixNQUFTO1FBQzVDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLG1GQUFtRjtRQUMzSCxNQUFNLFdBQVcsR0FBRyxtQkFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sVUFBVSxHQUFHLElBQUksdUJBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNwRCxVQUFVLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksVUFBVSxDQUFDLFlBQVksQ0FBQztRQUU5RixNQUFNLGNBQWMsR0FBRyxJQUFJLDJCQUEyQixDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUN4RSxNQUFNLE9BQU8sR0FBRyxJQUFJLGlDQUF1QixDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUN4RSxjQUFjLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUVqQyxPQUFPLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxR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